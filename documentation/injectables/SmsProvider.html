<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>buzz-core documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">buzz-core documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">












<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >SmsProvider</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/notification/services/providers/sms.provider.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>SMS Provider using Twilio API</p>
<p>Handles SMS sending operations using Twilio service.
Provides specialized methods for tourist notifications with formatted messages.
Validates credentials on initialization and provides phone number formatting.</p>

            </p>



            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#isInitialized" >isInitialized</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#logger" >logger</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#twilioClient" >twilioClient</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#buildTouristNotificationMessage" >buildTouristNotificationMessage</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#formatPhoneNumber" >formatPhoneNumber</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#getErrorMessage" >getErrorMessage</a>
                            </li>
                            <li>
                                <a href="#getStatus" >getStatus</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#initializeTwilio" >initializeTwilio</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#send" >send</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#sendTouristNotification" >sendTouristNotification</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#testCredentials" >testCredentials</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(configService: ConfigService)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="21" class="link-to-prism">src/notification/services/providers/sms.provider.ts:21</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>configService</td>
                                                  
                                                        <td>
                                                                    <code>ConfigService</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="buildTouristNotificationMessage"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>buildTouristNotificationMessage</b></span>
                        <a href="#buildTouristNotificationMessage"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>buildTouristNotificationMessage(userName: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, city: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, placeName: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, travelTime: <a href="../interfaces/TravelTime.html" target="_self">TravelTime</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="183"
                                    class="link-to-prism">src/notification/services/providers/sms.provider.ts:183</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Builds SMS message for tourist notification</p>
<p>Creates formatted SMS message with:</p>
<ul>
<li>Greeting with user name</li>
<li>City welcome</li>
<li>Place recommendation</li>
<li>Travel time info</li>
<li>BuzzCore signature
Truncates to 160 characters if too long</li>
</ul>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>userName</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>User name</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>city</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>City name</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>placeName</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>Place name</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>travelTime</td>
                                            <td>
                                                            <code><a href="../interfaces/TravelTime.html" target="_self" >TravelTime</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>Travel information</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </div>
                            <div class="io-description">
                                <p>Formatted SMS message</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="formatPhoneNumber"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>formatPhoneNumber</b></span>
                        <a href="#formatPhoneNumber"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>formatPhoneNumber(phone: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="222"
                                    class="link-to-prism">src/notification/services/providers/sms.provider.ts:222</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Formats phone number to international E.164 format</p>
<p>Handles multiple phone number formats:</p>
<ul>
<li>Already formatted: +573001234567</li>
<li>With country code: 573001234567</li>
<li>With leading zero: 03001234567</li>
<li>Local 10 digits: 3001234567
Defaults to Colombia (+57) if no country code provided</li>
</ul>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>phone</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>Phone number in any format</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </div>
                            <div class="io-description">
                                <p>Formatted phone number in E.164 format (+573001234567)</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getErrorMessage"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>getErrorMessage</b></span>
                        <a href="#getErrorMessage"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getErrorMessage(error: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="253"
                                    class="link-to-prism">src/notification/services/providers/sms.provider.ts:253</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Translates Twilio error codes to user-friendly messages</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>error</td>
                                            <td>
                                                            <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>Twilio error object</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </div>
                            <div class="io-description">
                                <p>Human-readable error message in Spanish</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getStatus"></a>
                    <span class="name">
                        <span ><b>getStatus</b></span>
                        <a href="#getStatus"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getStatus()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="310"
                                    class="link-to-prism">src/notification/services/providers/sms.provider.ts:310</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Gets provider initialization status</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-typescript">const status = smsProvider.getStatus();
console.log(status.initialized);
console.log(status.phoneNumber);</code></pre></div></div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>{ initialized: boolean; hasValidCredentials: boolean; hasValidPhone: boolean; phoneNumber: any; service: string; }</code>

                        </div>
                            <div class="io-description">
                                <p>Status object with credentials validation and phone number</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="initializeTwilio"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>initializeTwilio</b></span>
                        <a href="#initializeTwilio"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>initializeTwilio()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="38"
                                    class="link-to-prism">src/notification/services/providers/sms.provider.ts:38</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Initializes Twilio client with credential validation</p>
<p>Validates Twilio credentials from environment:</p>
<ul>
<li>TWILIO_ACCOUNT_SID must start with &#39;AC&#39;</li>
<li>TWILIO_AUTH_TOKEN must be at least 20 characters</li>
<li>TWILIO_PHONE_NUMBER must start with &#39;+&#39;
Sets isInitialized flag based on validation result</li>
</ul>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="send"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>send</b></span>
                        <a href="#send"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>send(to: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, message: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="81"
                                    class="link-to-prism">src/notification/services/providers/sms.provider.ts:81</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Sends an SMS using Twilio API</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-typescript">const result = await smsProvider.send(&#39;+573001234567&#39;, &#39;Hello World!&#39;);
if (result.success) console.log(&#39;SMS SID:&#39;, result.sid);</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>to</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>Recipient phone number (will be formatted automatically)</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>message</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>SMS message content (max 160 characters recommended)</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;SmsResult&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>Result with success status and SID or error</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sendTouristNotification"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>sendTouristNotification</b></span>
                        <a href="#sendTouristNotification"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>sendTouristNotification(to: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, userName: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, city: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, placeName: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, travelTime: <a href="../interfaces/TravelTime.html" target="_self">TravelTime</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="145"
                                    class="link-to-prism">src/notification/services/providers/sms.provider.ts:145</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Sends a tourist place recommendation SMS</p>
<p>Sends a formatted SMS with:</p>
<ul>
<li>Personalized greeting</li>
<li>Place name</li>
<li>Travel time and distance</li>
<li>Automatic truncation if exceeds 160 characters</li>
</ul>
<b>Example :</b><div><pre class="line-numbers"><code class="language-typescript">await smsProvider.sendTouristNotification(
  &#39;+573001234567&#39;,
  &#39;John&#39;,
  &#39;Bogotá&#39;,
  &#39;Monserrate&#39;,
  { duration: &#39;15 min&#39;, distance: &#39;2.5 km&#39;, success: true }
);</code></pre></div></div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>to</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>Recipient phone number</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>userName</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>User&#39;s name for personalization</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>city</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>Detected city name</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>placeName</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>Tourist place name</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>travelTime</td>
                                            <td>
                                                            <code><a href="../interfaces/TravelTime.html" target="_self" >TravelTime</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>Travel duration and distance</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;SmsResult&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>SMS sending result</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="testCredentials"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>testCredentials</b></span>
                        <a href="#testCredentials"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>testCredentials()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="281"
                                    class="link-to-prism">src/notification/services/providers/sms.provider.ts:281</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Tests Twilio credentials validity</p>
<p>Makes a test API call to verify credentials.
Useful for debugging connection issues.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-typescript">const test = await smsProvider.testCredentials();
if (!test.valid) console.error(test.error);</code></pre></div></div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;literal type&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>Validation result</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section data-compodoc="block-properties">
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isInitialized"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>isInitialized</b></span>
                        <a href="#isInitialized"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>false</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="21" class="link-to-prism">src/notification/services/providers/sms.provider.ts:21</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="logger"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>logger</b></span>
                        <a href="#logger"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>unknown</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new Logger(SmsProvider.name)</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="19" class="link-to-prism">src/notification/services/providers/sms.provider.ts:19</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="twilioClient"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>twilioClient</b></span>
                        <a href="#twilioClient"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="20" class="link-to-prism">src/notification/services/providers/sms.provider.ts:20</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable, Logger } from &#x27;@nestjs/common&#x27;;
import { ConfigService } from &#x27;@nestjs/config&#x27;;
import Twilio from &#x27;twilio&#x27;;
import { SmsResult, TravelTime } from &#x27;../../types/notification.types&#x27;;

/**
 * SMS Provider using Twilio API
 * 
 * @description
 * Handles SMS sending operations using Twilio service.
 * Provides specialized methods for tourist notifications with formatted messages.
 * Validates credentials on initialization and provides phone number formatting.
 * 
 * @export
 * @class SmsProvider
 */
@Injectable()
export class SmsProvider {
  private readonly logger &#x3D; new Logger(SmsProvider.name);
  private twilioClient: any;
  private isInitialized: boolean &#x3D; false;

  constructor(private configService: ConfigService) {
    this.initializeTwilio();
  }

  /**
   * Initializes Twilio client with credential validation
   * 
   * @private
   * @description
   * Validates Twilio credentials from environment:
   * - TWILIO_ACCOUNT_SID must start with &#x27;AC&#x27;
   * - TWILIO_AUTH_TOKEN must be at least 20 characters
   * - TWILIO_PHONE_NUMBER must start with &#x27;+&#x27;
   * Sets isInitialized flag based on validation result
   */
  private initializeTwilio() {
    const accountSid &#x3D; this.configService.get(&#x27;TWILIO_ACCOUNT_SID&#x27;);
    const authToken &#x3D; this.configService.get(&#x27;TWILIO_AUTH_TOKEN&#x27;);
    const twilioPhone &#x3D; this.configService.get(&#x27;TWILIO_PHONE_NUMBER&#x27;);

    if (!accountSid || !accountSid.startsWith(&#x27;AC&#x27;)) {
      this.logger.error(&#x27;TWILIO_ACCOUNT_SID NO VÁLIDA&#x27;);
      return;
    }

    if (!authToken || authToken.length &lt; 20) {
      this.logger.error(&#x27;TWILIO_AUTH_TOKEN NO VÁLIDO&#x27;);
      return;
    }

    if (!twilioPhone || !twilioPhone.startsWith(&#x27;+&#x27;)) {
      this.logger.error(&#x27;TWILIO_PHONE_NUMBER NO VÁLIDO&#x27;);
      return;
    }

    try {
      this.twilioClient &#x3D; Twilio(accountSid, authToken);
      this.isInitialized &#x3D; true;
      this.logger.log(&#x27;Twilio SMS Provider INICIALIZADO PARA PRODUCCIÓN&#x27;);
      this.logger.log(&#x60;   Número Twilio: ${twilioPhone}&#x60;);
    } catch (error) {
      this.logger.error(&#x27;FALLÓ INICIALIZACIÓN DE TWILIO:&#x27;, error.message);
    }
  }

  /**
   * Sends an SMS using Twilio API
   * 
   * @param {string} to - Recipient phone number (will be formatted automatically)
   * @param {string} message - SMS message content (max 160 characters recommended)
   * @returns {Promise&lt;SmsResult&gt;} Result with success status and SID or error
   * 
   * @example
   * &#x60;&#x60;&#x60;typescript
   * const result &#x3D; await smsProvider.send(&#x27;+573001234567&#x27;, &#x27;Hello World!&#x27;);
   * if (result.success) console.log(&#x27;SMS SID:&#x27;, result.sid);
   * &#x60;&#x60;&#x60;
   */
  async send(to: string, message: string): Promise&lt;SmsResult&gt; {
    if (!this.isInitialized) {
      const error &#x3D; &#x27;Twilio no configurado - Verifica credenciales&#x27;;
      this.logger.error(error);
      return { success: false, error };
    }

    const twilioPhone &#x3D; this.configService.get(&#x27;TWILIO_PHONE_NUMBER&#x27;);

    try {
      const formattedTo &#x3D; this.formatPhoneNumber(to);
      
      this.logger.log(&#x60;ENVIANDO SMS REAL a: ${formattedTo}&#x60;);
      
      const result &#x3D; await this.twilioClient.messages.create({
        body: message,
        from: twilioPhone,
        to: formattedTo,
      });

      this.logger.log(&#x60;SMS REAL ENVIADO a: ${formattedTo}&#x60;);
      this.logger.log(&#x60;SID: ${result.sid}, Estado: ${result.status}&#x60;);
      
      return { 
        success: true, 
        sid: result.sid 
      };
    } catch (error) {
      this.logger.error(&#x60;FALLÓ ENVÍO DE SMS REAL a ${to}:&#x60;, error.message);
      return { 
        success: false, 
        error: this.getErrorMessage(error) 
      };
    }
  }

  /**
   * Sends a tourist place recommendation SMS
   * 
   * @description
   * Sends a formatted SMS with:
   * - Personalized greeting
   * - Place name
   * - Travel time and distance
   * - Automatic truncation if exceeds 160 characters
   * 
   * @param {string} to - Recipient phone number
   * @param {string} userName - User&#x27;s name for personalization
   * @param {string} city - Detected city name
   * @param {string} placeName - Tourist place name
   * @param {TravelTime} travelTime - Travel duration and distance
   * @returns {Promise&lt;SmsResult&gt;} SMS sending result
   * 
   * @example
   * &#x60;&#x60;&#x60;typescript
   * await smsProvider.sendTouristNotification(
   *   &#x27;+573001234567&#x27;,
   *   &#x27;John&#x27;,
   *   &#x27;Bogotá&#x27;,
   *   &#x27;Monserrate&#x27;,
   *   { duration: &#x27;15 min&#x27;, distance: &#x27;2.5 km&#x27;, success: true }
   * );
   * &#x60;&#x60;&#x60;
   */
  async sendTouristNotification(
    to: string, 
    userName: string,
    city: string,
    placeName: string,
    travelTime: TravelTime 
  ): Promise&lt;SmsResult&gt; {
    
    const smsMessage &#x3D; this.buildTouristNotificationMessage(
      userName,
      city,
      placeName, 
      travelTime
    );
    
    this.logger.log(&#x60;ENVIANDO NOTIFICACIÓN TURÍSTICA SMS REAL a: ${to}&#x60;);
    return this.send(to, smsMessage);
  }

  /**
   * Builds SMS message for tourist notification
   * 
   * @private
   * @description
   * Creates formatted SMS message with:
   * - Greeting with user name
   * - City welcome
   * - Place recommendation
   * - Travel time info
   * - BuzzCore signature
   * Truncates to 160 characters if too long
   * 
   * @param {string} userName - User name
   * @param {string} city - City name
   * @param {string} placeName - Place name
   * @param {TravelTime} travelTime - Travel information
   * @returns {string} Formatted SMS message
   */
  private buildTouristNotificationMessage(
    userName: string,
    city: string,
    placeName: string,
    travelTime: TravelTime
  ): string {
    const baseMessage &#x3D; &#x60;¡Hola ${userName}! \n\nBienvenido/a a ${city}. Te recomendamos visitar:\n\n ${placeName}\n\n&#x60;;
    
    const travelInfo &#x3D; travelTime.success ? 
      &#x60;🚶 ${travelTime.duration} (${travelTime.distance})\n\n&#x60; : 
      &#x27;📍 Cercano a tu ubicación\n\n&#x27;;
    
    const footer &#x3D; &#x60;¡Disfruta tu visita a ${city}!\n\n- BuzzCore Turístico&#x60;;
    
    const fullMessage &#x3D; baseMessage + travelInfo + footer;
    
    if (fullMessage.length &gt; 160) {
      return baseMessage.substring(0, 150) + &#x27;...\n\n- BuzzCore&#x27;;
    }
    
    return fullMessage;
  }

  /**
   * Formats phone number to international E.164 format
   * 
   * @private
   * @description
   * Handles multiple phone number formats:
   * - Already formatted: +573001234567
   * - With country code: 573001234567
   * - With leading zero: 03001234567
   * - Local 10 digits: 3001234567
   * Defaults to Colombia (+57) if no country code provided
   * 
   * @param {string} phone - Phone number in any format
   * @returns {string} Formatted phone number in E.164 format (+573001234567)
   * @throws {Error} If phone format is not supported
   */
  private formatPhoneNumber(phone: string): string {
    if (!phone) throw new Error(&#x27;Número de teléfono requerido&#x27;);

    const cleaned &#x3D; phone.replace(/[^\d+]/g, &#x27;&#x27;);

    if (cleaned.startsWith(&#x27;+&#x27;)) {
      return cleaned;
    }
    
    if (cleaned.startsWith(&#x27;57&#x27;) &amp;&amp; cleaned.length &gt;&#x3D; 12) {
      return &#x60;+${cleaned}&#x60;;
    }
    
    if (cleaned.startsWith(&#x27;0&#x27;)) {
      return &#x60;+57${cleaned.substring(1)}&#x60;;
    }
    
    if (/^\d{10}$/.test(cleaned)) {
      return &#x60;+57${cleaned}&#x60;;
    }

    throw new Error(&#x60;Formato de teléfono no soportado: ${phone}&#x60;);
  }

  /**
   * Translates Twilio error codes to user-friendly messages
   * 
   * @private
   * @param {any} error - Twilio error object
   * @returns {string} Human-readable error message in Spanish
   */
  private getErrorMessage(error: any): string {
    if (!error) return &#x27;Error desconocido&#x27;;
    
    switch (error.code) {
      case 20003: return &#x27;Autenticación fallida - Verifica Account SID y Auth Token&#x27;;
      case 21211: return &#x27;Número de teléfono inválido&#x27;;
      case 21408: return &#x27;Sin permisos para enviar SMS&#x27;;
      case 21610: return &#x27;Número no verificado (modo sandbox)&#x27;;
      case 30007: return &#x27;Entrega fallida - Verifica número&#x27;;
      default: return error.message || &#x60;Error Twilio: ${error.code}&#x60;;
    }
  }

  /**
   * Tests Twilio credentials validity
   * 
   * @description
   * Makes a test API call to verify credentials.
   * Useful for debugging connection issues.
   * 
   * @returns {Promise&lt;{valid: boolean, error?: string}&gt;} Validation result
   * 
   * @example
   * &#x60;&#x60;&#x60;typescript
   * const test &#x3D; await smsProvider.testCredentials();
   * if (!test.valid) console.error(test.error);
   * &#x60;&#x60;&#x60;
   */
  async testCredentials(): Promise&lt;{ valid: boolean; error?: string }&gt; {
    try {
      const accountSid &#x3D; this.configService.get(&#x27;TWILIO_ACCOUNT_SID&#x27;);
      const testClient &#x3D; Twilio(accountSid, this.configService.get(&#x27;TWILIO_AUTH_TOKEN&#x27;));
      const account &#x3D; await testClient.api.accounts(accountSid).fetch();
      
      this.logger.log(&#x27;CREDENCIALES TWILIO VÁLIDAS&#x27;);
      return { valid: true };
    } catch (error) {
      this.logger.error(&#x27;CREDENCIALES TWILIO INVÁLIDAS&#x27;);
      return { 
        valid: false, 
        error: &#x60;Autenticación fallida: ${error.message}&#x60; 
      };
    }
  }

  /**
   * Gets provider initialization status
   * 
   * @returns {Object} Status object with credentials validation and phone number
   * 
   * @example
   * &#x60;&#x60;&#x60;typescript
   * const status &#x3D; smsProvider.getStatus();
   * console.log(status.initialized);
   * console.log(status.phoneNumber);
   * &#x60;&#x60;&#x60;
   */
  getStatus() {
    const accountSid &#x3D; this.configService.get(&#x27;TWILIO_ACCOUNT_SID&#x27;);
    const authToken &#x3D; this.configService.get(&#x27;TWILIO_AUTH_TOKEN&#x27;);
    const twilioPhone &#x3D; this.configService.get(&#x27;TWILIO_PHONE_NUMBER&#x27;);
    
    return {
      initialized: this.isInitialized,
      hasValidCredentials: !!(accountSid &amp;&amp; authToken),
      hasValidPhone: !!(twilioPhone &amp;&amp; twilioPhone.startsWith(&#x27;+&#x27;)),
      phoneNumber: twilioPhone,
      service: &#x27;Twilio&#x27;
    };
  }
}</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'SmsProvider.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
